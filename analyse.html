<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <!-- MDUI styles -->
    <link rel="stylesheet" href="https://unpkg.com/mdui@2/mdui.css">
    <script src="https://unpkg.com/mdui@2/mdui.global.js"></script>
</head>

<body>
    <div class="mdui-container">
        <mdui-chip>概览</mdui-chip>
        <mdui-list>
            <mdui-list-item id="todayUser">今日活跃量</mdui-list-item>
            <mdui-list-item id="todayRequests">今日请求量</mdui-list-item>
            <mdui-list-item id="totalRequests">总请求量</mdui-list-item>
        </mdui-list>

        <mdui-chip>排行</mdui-chip>
        <div id="rankChart" style="width: 100%; height: 1500px;"></div>

    </div>

    <!-- MDUI scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mdui/0.4.3/js/mdui.min.js"
        integrity="sha384-jxNm6XccHP9Qbx4mHISj5x/xlpLj/4hOcZc+d+nHhBJm+G6qLGoNRv6bQ9Uu2Btz"
        crossorigin="anonymous"></script>
    <!-- ECharts script -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.2.2/dist/echarts.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // 获取今日活跃量和请求量数据
            fetch('http://47.96.80.84:5000/active_users?id=122')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('todayUser').innerHTML = "今日活跃量:" + data.daily_active_users
                    document.getElementById('todayRequests').innerHTML = "今日请求量:" + data.daily_requests
                    document.getElementById('totalRequests').innerHTML = "总请求量:" + data.total_requests
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });

            // 获取排行榜数据并生成ECharts图表
            fetch('http://47.96.80.84:5000/rank')
                .then(response => response.json())
                .then(rankData => {
                    var cate = rankData.map(item => item[0]);
                    var barData = rankData.map(item => item[1]);

                    // 初始化ECharts实例
                    var myChart  = echarts.init(document.getElementById('rankChart'));

                    var option = {
        
                        tooltip: {
                            trigger: "axis",
                            axisPointer: {
                                type: "shadow",
                            },
                        },
                        //图表位置
                        grid: {
                            left: "3%",
                            right: "4%",
                            bottom: "3%",
                            containLabel: true,
                        },
                        //X轴
                        xAxis: {
                            type: "value",
                            axisLine: {
                                show: false,
                            },
                            axisTick: {
                                show: false,
                            },
                            //不显示X轴刻度线和数字
                            splitLine: { show: false },
                            axisLabel: { show: false },
                        },
                        yAxis: {
                            type: "category",
                            data: cate,
                            //升序
                            inverse: true,
                            splitLine: { show: false },
                            axisLine: {
                                show: false,
                            },
                            axisTick: {
                                show: false,
                            },
                            //key和图间距
                            offset: 10,
                            //动画部分
                            animationDuration: 300,
                            animationDurationUpdate: 300,
                            //key文字大小
                            nameTextStyle: {
                                fontSize: 5,
                            },
                        },
                        series: [
                            {
                                //柱状图自动排序，排序自动让Y轴名字跟着数据动
                                realtimeSort: true,
                                name: "数量",
                                type: "bar",
                                data: barData,
                                barWidth: 14,
                                barGap: 10,
                                smooth: true,
                                valueAnimation: true,
                                //Y轴数字显示部分
                                label: {
                                    normal: {
                                        show: true,
                                        position: "right",
                                        valueAnimation: true,
                                        offset: [5, -2],
                                        textStyle: {
                                            color: "#333",
                                            fontSize: 13,
                                        },
                                    },
                                },
                                itemStyle: {
                                    emphasis: {
                                        barBorderRadius: 7,
                                    },
                                    //颜色样式部分
                                    normal: {
                                        barBorderRadius: 7,
                                        color: new echarts.graphic.LinearGradient(0, 0, 1, 0, [
                                            { offset: 0, color: "#3977E6" },
                                            { offset: 1, color: "#37BBF8" },
                                        ]),
                                    },
                                },
                            },
                        ],
                        //动画部分

                        animationDuration: 0,
                        animationDurationUpdate: 3000,
                        animationEasing: "linear",
                        animationEasingUpdate: "linear",
                    };
                    myChart.setOption(option);
                    //图表大小变动从新渲染，动态自适应
                    window.addEventListener("resize", function () {
                        myChart.resize();
                    });
                })
                .catch(error => {
                    console.error('Error fetching rank data:', error);
                });
        });
        
    </script>
</body>

</html>
